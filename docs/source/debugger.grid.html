<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='global-property-'>/**
</span> * Created with JetBrains RubyMine.
 * User: teamco
 * Date: 5/6/13
 * Time: 9:22 PM
 */
define([
    &#39;config/anthill&#39;
], function defineDebuggerGrid(AntHill) {

<span id='DebuggerGrid-method-constructor'><span id='DebuggerGrid'>    /**
</span></span>     * Define Debugger Grid
     * @param {*} debug
     * @class DebuggerGrid
     * @constructor
     */
    var DebuggerGrid = function DebuggerGrid(debug) {

<span id='DebuggerGrid-property-bugger'>        /**
</span>         * Define debugger
         * @type {Debugger}
         */
        this.bugger = debug;

        this.visibility(false);
    };

    return DebuggerGrid.extend({

<span id='DebuggerGrid-method-bindToggleGrid'>        /**
</span>         * Toggle grid
         */
        bindToggleGrid: function bindToggleGrid() {

            var $label = $(&#39;.handler input:first+label&#39;, this.bugger.info);

            $label.on(
                &#39;click.toggleGrid&#39;,
                function toggleGrid() {

                    if (this.bugger.grid.visible) {
                        $label.text($label.text().replace(/Hide/, &#39;Show&#39;));
                        return this.bugger.grid.destroyGrid();
                    }

                    $label.text($label.text().replace(/Show/, &#39;Hide&#39;));

                    this.bugger.grid.showGrid();

                }.bind(this)
            );
        },

<span id='DebuggerGrid-method-showGrid'>        /**
</span>         * Show grid
         */
        showGrid: function showGrid() {
            this.destroyGrid();
            this.checkAndPlaceGrid();

            this.visibility(true);
        },

<span id='DebuggerGrid-method-visibility'>         /**
</span>         * Set grid visibility
         * @param {boolean} visible
         * @returns {visible|*}
         */
         visibility: function visibility(visible) {

            if (this.base.isDefined(visible)) {
                this.visible = visible;
            }

            return this.visible;
        },

<span id='DebuggerGrid-method-destroyGrid'>        /**
</span>         * Destroy grid
         */
        destroyGrid: function destroyGrid() {
            $(this.bugger.placeholders).empty();

            this.visibility(false);
        },

<span id='DebuggerGrid-method-createPlaceHolder'>        /**
</span>         * Create placeholder
         * @returns {*}
         */
        createPlaceHolder: function createPlaceHolder() {
            return $(&#39;&lt;div /&gt;&#39;).attr({
                id: this.bugger.placeholders.replace(/#/, &#39;&#39;)
            });
        },

<span id='DebuggerGrid-method-movePlaceHoldersToCurrentPage'>        /**
</span>         * Move grid placeholder to current page
         * @returns {*}
         */
        movePlaceHoldersToCurrentPage: function movePlaceHoldersToCurrentPage() {
            var $page = this.bugger.scopes.page.view.elements.$page.$,
                $placeholder = $(this.bugger.placeholders);

            if ($page.find(this.bugger.placeholders).length === 0) {
                if ($placeholder.length === 0) {
                    $placeholder = this.createPlaceHolder();
                }

                $page.append($placeholder);
            }

            return $page.find(this.bugger.placeholders);
        },

<span id='DebuggerGrid-method-checkAndPlaceGrid'>        /**
</span>         * Render grid
         */
        checkAndPlaceGrid: function checkAndPlaceGrid() {
            var scope = this.bugger.scope;
            if ($(this.bugger.placeholders + &#39; &gt; *&#39;).length &gt; 0) {
                scope.logger.info(&#39;Grid already activated&#39;, scope);
                return false;
            }
            this.movePlaceHoldersToCurrentPage();

            var column = 0, row = 0,
                page = this.bugger.scopes.page,
                grid = page.layout.config.grid,
                cell = grid.minCellWidth,
                margin = grid.margin,

                opts = {
                    cell: cell,
                    margin: margin,
                    top: 0,
                    left: 0
                };

            $(this.bugger.placeholders).
                append($(&#39;&lt;div /&gt;&#39;).addClass(&#39;column&#39;)).
                append($(&#39;&lt;div /&gt;&#39;).addClass(&#39;row&#39;));

            for (column; column &lt; grid.columns; column += 1) {
                this.renderColumn(column, opts);
            }

            for (row; row &lt; this.bugger.rows; row += 1) {
                this.renderRow(row, opts);
            }
        },

<span id='DebuggerGrid-method-renderColumn'>        /**
</span>         * Render column
         * @param {number} column
         * @param {{left, cell, margin, top}} opts
         */
        renderColumn: function renderColumn(column, opts) {
            this.renderPlaceHolder(
                this.bugger.placeholders + &#39; .column&#39;, {
                    width: opts.cell,
                    top: opts.top,
                    left: this.bugger.scopes.page.layout.controller.getNextPosition({
                        column: column,
                        row: 0
                    }).left,
                    text: column
                }
            );
        },

<span id='DebuggerGrid-method-renderRow'>        /**
</span>         * Render row
         * @param {number} row
         * @param {{left, cell, margin, top}} opts
         */
        renderRow: function renderRow(row, opts) {
            this.renderPlaceHolder(
                this.bugger.placeholders + &#39; .row&#39;, {
                    left: opts.left,
                    top: this.bugger.scopes.page.layout.controller.getNextPosition({
                        column: 0,
                        row: row
                    }).top,
                    height: opts.cell,
                    text: row
                }
            );
        },

<span id='DebuggerGrid-method-renderPlaceHolder'>        /**
</span>         * Append grid to placeholder
         * @param {string} selector
         * @param {{left, top, [width], [height], text}}opts
         */
        renderPlaceHolder: function renderPlaceHolder(selector, opts) {
            opts = this.base.define(opts, {}, true);
            $(selector).append(
                $(&#39;&lt;div /&gt;&#39;).css({
                    left: opts.left,
                    top: opts.top,
                    width: opts.width || &#39;100%&#39;,
                    height: opts.height || &#39;100%&#39;
                }).text(opts.text)
            ).show()
        }

    }, AntHill.prototype);

});</pre>
</body>
</html>
