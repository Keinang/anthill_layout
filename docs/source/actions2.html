<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='global-property-'>/**
</span> * Created with JetBrains RubyMine.
 * User: teamco
 * Date: 5/6/13
 * Time: 9:03 PM
 */

define([], function defineDebuggerActions() {

<span id='Actions-method-constructor'><span id='Actions'>    /**
</span></span>     * Define Debugger Workspace
     * @constructor
     */
    var Actions = function Actions() {

    };

    return Actions.extend({

<span id='Actions-method-extendSelectors'>        /**
</span>         * Extend debugger selectors
         * @param {*} opts
         */
        extendSelectors: function extendSelectors(opts) {
            this.selectors = {};
            $.each(opts || {}, function each(i, selector) {
                this.selectors[i] = [this.debugger.info, selector].join(&#39; &#39;);
            }.bind(this));

        },

<span id='Actions-method-renderItemsActions'>        /**
</span>         * Render page items actions
         * @returns {string}
         */
        renderItemsActions: function renderItemsActions() {
            return [
                &#39;&lt;li class=&quot;extend&quot;&gt;&lt;ul class=&quot;actions&quot;&gt;&#39;,
                this._renderActions(),
                this._renderEnableEditMode(),
                &#39;&lt;/ul&gt;&lt;/li&gt;&#39;
            ].join(&#39;&#39;);
        },

        _renderActions: function _renderActions() {
            var html = [];
            $.each(this.actions, function each(i, action) {
                var fn = this[&#39;_&#39; + action.toCamel()];
                console.log(fn)
                if (this.debugger.base.isFunction(fn)) {
                    html.push(fn.bind(this)());
                }
            }.bind(this));
            return html.join(&#39;&#39;);
        },

<span id='Actions-method-_addItem'>        /**
</span>         * Render add new item button
         * @returns {string}
         * @private
         */
        _addItem: function _addItem() {
            return this.debugger.component.renderInlineAction({
                rel: &#39;disabled&#39;,
                style: &#39;disabled&#39;,
                title: &#39;Add item&#39;
            });
        },

<span id='Actions-method-_removeItem'>        /**
</span>         * Render remove item button
         * @returns {string}
         * @private
         */
        _removeItem: function _renderRemoveItem() {
            return this.debugger.component.renderInlineAction({
                rel: &#39;disabled&#39;,
                style: &#39;disabled select&#39;,
                title: &#39;Remove items&#39;
            });
        },

<span id='Actions-method-_renderRemoveItems'>        /**
</span>         * Render remove items button
         * @returns {string}
         * @private
         */
        _renderRemoveItems: function _renderRemoveItems() {
            return this.debugger.component.renderInlineAction({
                rel: &#39;disabled&#39;,
                style: &#39;disabled select&#39;,
                title: &#39;Remove all items&#39;
            });
        },

<span id='Actions-method-_renderLocateItem'>        /**
</span>         * Render locate item button
         * @returns {string}
         * @private
         */
        _renderLocateItem: function _renderLocateItem() {
            return this.debugger.component.renderInlineAction({
                rel: &#39;disabled&#39;,
                style: &#39;disabled select&#39;,
                title: &#39;Locate item&#39;
            });
        },

<span id='Actions-method-_renderEnableEditMode'>        /**
</span>         * Render enable edit mode
         * @returns {string}
         * @private
         */
        _renderEnableEditMode: function _renderEnableEditMode() {
            return this.debugger.component.renderInlineAction({
                rel: &#39;disabled&#39;,
                title: &#39;Edit mode&#39;
            });
        },

<span id='Actions-method-renderPageItems'>        /**
</span>         * Render page items info
         * @param {*} page
         * @returns {string}
         */
        renderPageItems: function renderPageItems(page) {
            return [
                &#39;&lt;li class=&quot;extend&quot;&gt;&#39;,
                this.debugger.component.renderBlock(&#39;Items&#39;, [
                    this.renderPageItemsActions(),
                    this._getItemsCount(page),
                    this.renderPageItemsList(page)
                ], true),
                &#39;&lt;/li&gt;&#39;
            ].join(&#39; &#39;);
        },

<span id='Actions-method-renderPageItemsList'>        /**
</span>         * Render page items list
         * @param page
         * @returns {string}
         */
        renderPageItemsList: function renderPageItemsList(page) {
            var html = [&#39;&lt;li class=&quot;extend&quot;&gt;&lt;ul class=&quot;items-info&quot;&gt;&#39;];
            html.push(this.getPageItemsList(page));
            html.push(&#39;&lt;/ul&gt;&lt;/li&gt;&#39;);
            return html.join(&#39;&#39;);
        },

<span id='Actions-method-getPageItemsList'>        /**
</span>         * Get page item list
         * @param page
         * @returns {string}
         */
        getPageItemsList: function getPageItemsList(page) {
            var html = [];
            $.each(page.items, function each(uuid, item) {
                html.push([
                    &#39;&lt;li class=&quot;&#39;, item.model.getConfig(&#39;type&#39;), &#39;&quot;&gt;&#39;, uuid , &#39;&lt;/li&gt;&#39;
                ].join(&#39;&#39;));
            });

            return html.join(&#39;&#39;);
        },

<span id='Actions-method-updateItems'>        /**
</span>         * Update page item list
         * @param page
         */
        updateItems: function updateItems(page) {
            $(this.selectors.items).html(
                this.getPageItemsList(page)
            );

            var $count = $(this.selectors.count);

            $count.before(
                this._getItemsCount(page)
            ).remove();

            this._bindItemsList(page);
            this.$select.addClass(&#39;select&#39;);
        },

<span id='Actions-method-_getItemsCount'>        /**
</span>         * Get items count
         * @param {*} page
         * @returns {string}
         * @private
         */
        _getItemsCount: function _getItemsCount(page) {
            return this.debugger.component.renderInlineOf(&#39;Count&#39;, page);
        },

<span id='Actions-method-_getItemAction'>        /**
</span>         * Get page item action button
         * @param {String} action
         * @returns {*|jQuery|HTMLElement}
         * @private
         */
        _getItemAction: function _getItemAction(action) {
            return $(&#39;li.&#39; + action, this.selectors.actions);
        },

<span id='Actions-method-bindEnablePageItemsEditMode'>        /**
</span>         * Bind enable page item edit mode,
         * @param {*} page
         */
        bindEnablePageItemsEditMode: function bindEnablePageItemsEditMode(page) {
            $(this.selectors.edit).on(&#39;click.edit&#39;, function edit(e) {
                this._enablePageItemsEditMode(e, page);
            }.bind(this));
        },

<span id='Actions-method-_bindItemsList'>        /**
</span>         * Bind item list
         * @param page
         * @private
         */
        _bindItemsList: function _bindItemsList(page) {
            this.$select = this.debugger.base.define(
                this.$select,
                $(&#39;.select&#39;, this.selectors.actions)
            );

            if (this.editMode) {
                $(&#39;li&#39;, this.selectors.items).on(&#39;click.select&#39;, function select(e) {
                    var $li = $(e.target),
                        item = page.items[$li.text()];

                    if ($li.hasClass(&#39;select&#39;)) {
                        page.logger.debug(&#39;Unselect&#39;, item);
                        $li.removeClass(&#39;select&#39;);
                        this.$select.addClass(&#39;select&#39;);
                    } else {
                        page.logger.debug(&#39;Select&#39;, item);
                        $li.addClass(&#39;select&#39;);
                        this.$select.removeClass(&#39;select&#39;);
                    }

                    var $select = $(&#39;li.select&#39;, this.selectors.items),
                        $locate = this._getItemAction(&#39;locate-item&#39;);

                    $select.length === 1 ?
                        $locate.removeClass(&#39;disabled select&#39;) :
                        $locate.addClass(&#39;disabled select&#39;);

                }.bind(this));
            }
        },

<span id='Actions-method-_unbindItemsList'>        /**
</span>         * Unbind item list
         * @private
         */
        _unbindItemsList: function _unbindItemsList() {
            $(&#39;li&#39;, this.selectors.items).unbind(&#39;click.select&#39;);
        },

<span id='Actions-method-_enablePageItemsEditMode'>        /**
</span>         * Enable page item edit mode
         * @param {*} e
         * @param {*} page
         * @private
         */
        _enablePageItemsEditMode: function _enablePageItemsEditMode(e, page) {
            var $this = $(e.target),
                $disabled = $(&#39;li[rel=&quot;disabled&quot;]&#39;, $this.parent(&#39;ul&#39;));
            if ($disabled.hasClass(&#39;disabled&#39;)) {
                page.logger.debug(&#39;Activate edit mode&#39;);
                $disabled.removeClass(&#39;disabled&#39;);
                $this.addClass(&#39;active&#39;);
                this.editMode = true;
                this._bindItemsList(page);
                this._bindAddNewItem(page);
                this._bindRemoveItem(page);
                this._bindRemoveAllItems(page);
                this._bindLocateItem(page);
            } else {
                this._disablePageItemsEditMode($this, page);
            }
        },

<span id='Actions-method-_disablePageItemsEditMode'>        /**
</span>         * Disable page item edit mode
         * @param {*} $this
         * @param {*} page
         * @private
         */
        _disablePageItemsEditMode: function _disablePageItemsEditMode($this, page) {
            var $disabled = $(&#39;li[rel=&quot;disabled&quot;]&#39;, $this.parent(&#39;ul&#39;));

            page.logger.debug(&#39;Deactivate edit mode&#39;);
            $disabled.addClass(&#39;disabled&#39;);
            $this.removeClass(&#39;active&#39;);
            this._unbindAddNewItem(page);
            this._unbindRemoveItem(page);
            this._unbindRemoveAllItems(page);
            this._unbindLocateItem(page);
            this._unbindItemsList();
            this.editMode = false;
        },

<span id='Actions-method-_bindAddNewItem'>        /**
</span>         * Bind add new item
         * @param {*} page
         * @private
         */
        _bindAddNewItem: function _bindAddNewItem(page) {
            page.logger.debug(&#39;Bind edit mode&#39;);
            this._getItemAction(&#39;add-item&#39;).on(&#39;click.add&#39;, function (e) {
                page.api.createItem([], true);
                this._getItemAction(&#39;remove-items&#39;).removeClass(&#39;disabled&#39;);
            }.bind(this));
        },

<span id='Actions-method-_unbindAddNewItem'>        /**
</span>         * Unbind add new item
         * @param {*} page
         * @private
         */
        _unbindAddNewItem: function _unbindAddNewItem(page) {
            page.logger.debug(&#39;Unbind Add item&#39;);
            this._getItemAction(&#39;add-item&#39;).unbind(&#39;click.add&#39;);
        },

<span id='Actions-method-_bindRemoveItem'>        /**
</span>         * Bind remove items
         * @param page
         * @private
         */
        _bindRemoveItem: function _bindRemoveItem(page) {
            page.logger.debug(&#39;Bind remove items&#39;);
            this._getItemAction(&#39;remove-item&#39;).on(&#39;click.remove&#39;, function remove(e) {
                if ($(&#39;li.select&#39;, this.selectors.items).length === 0) {
                    page.logger.warn(&#39;Select items before remove&#39;);
                    return false;
                }
                this._removeItems(page);
            }.bind(this));
        },

<span id='Actions-method-_unbindRemoveItem'>        /**
</span>         * Unbind remove items
         * @param {*} page
         * @private
         */
        _unbindRemoveItem: function _unbindRemoveItem(page) {
            page.logger.debug(&#39;Unbind remove items&#39;);
            this._getItemAction(&#39;remove-item&#39;).unbind(&#39;click.remove&#39;);
            $(&#39;li&#39;, this.selectors.items).removeClass(&#39;select&#39;);
        },

<span id='Actions-method-_bindRemoveAllItems'>        /**
</span>         * Bind remove all items
         * @param page
         * @private
         */
        _bindRemoveAllItems: function _bindRemoveAllItems(page) {
            var $lis = $(&#39;li&#39;, this.selectors.items),
                $action = this._getItemAction(&#39;remove-items&#39;);
            page.logger.debug(&#39;Bind remove all items&#39;);

            if ($lis.length === 0) {
                $action.addClass(&#39;disabled&#39;);
            }

            $action.on(&#39;click.remove&#39;, function remove(e) {
                if ($lis.length === 0) {
                    page.logger.warn(&#39;Add items before remove&#39;);
                    return false;
                }
                this._removeAllItems(page);
            }.bind(this));
        },

<span id='Actions-method-_unbindRemoveAllItems'>        /**
</span>         * Unbind remove all items
         * @param {*} page
         * @private
         */
        _unbindRemoveAllItems: function _unbindRemoveAllItems(page) {
            page.logger.debug(&#39;Unbind remove all items&#39;);
            this._getItemAction(&#39;remove-items&#39;).unbind(&#39;click.remove&#39;);
            $(&#39;li&#39;, this.selectors.items).removeClass(&#39;select&#39;);
        },

<span id='Actions-method-_bindLocateItem'>        /**
</span>         * Bind locate item
         * @param page
         * @private
         */
        _bindLocateItem: function _bindLocateItem(page) {
            page.logger.debug(&#39;Bind locate item&#39;);

            this._getItemAction(&#39;locate-item&#39;).on(&#39;click.locate&#39;, function locate(e) {
                this._locateItem(page);
            }.bind(this));
        },

<span id='Actions-method-_unbindLocateItem'>        /**
</span>         * Unbind remove all items
         * @param {*} page
         * @private
         */
        _unbindLocateItem: function _unbindLocateItem(page) {
            page.logger.debug(&#39;Unbind locate item&#39;);
            this._getItemAction(&#39;locate-item&#39;).unbind(&#39;click.locate&#39;);
//            $(&#39;li&#39;, this.selectors.items).removeClass(&#39;select&#39;);
        },

        _locateItem: function _locateItem(page) {
//            var $li = $(&#39;li.select&#39;, this.selectors.items);
//
//            if ($li.length !== 1) {
//                page.logger.warn(&#39;Select one item before locate&#39;);
//                return false;
//            }
//
//            var uuid = $li.text(),
//                item = page.model.getItemByUUID(uuid);
//
//            if (!this.debugger.base.isDefined(item)) {
//                page.logger.warn(&#39;Undefined item&#39;, uuid);
//                return false;
//            }
//
//            page.logger.warn(&#39;Locate&#39;, item);

        },

<span id='Actions-method-_removeItems'>        /**
</span>         * Remove items
         * @param {*} page
         * @private
         */
        _removeItems: function _removeItems(page) {
            var items = {};
//            $.each($(&#39;li.select&#39;, this.selectors.items), function each(i, v) {
//                var uuid = $(v).text();
//                items[uuid] = page.model.getItemByUUID(uuid);
//            });
//
//            page.logger.debug(&#39;Start remove items&#39;, items);
//            page.api.destroyItems(items);

        },

<span id='Actions-method-_removeAllItems'>        /**
</span>         * Remove items
         * @param {*} page
         * @private
         */
        _removeAllItems: function _removeAllItems(page) {
//            $(&#39;li&#39;, this.selectors.items).addClass(&#39;select&#39;);
//            this._getItemAction(&#39;remove-items&#39;).addClass(&#39;disabled&#39;);
//            page.logger.debug(&#39;Start remove all items&#39;);
//            this._removeItems(page);
        }
    });
});
</pre>
</body>
</html>
