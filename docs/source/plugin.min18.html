<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">tinymce.PluginManager.add(&quot;image&quot;,function(a){function b(a,b){function c(a,c){d.parentNode&amp;&amp;d.parentNode.removeChild(d),b({width:a,height:c})}var d=document.createElement(&quot;img&quot;);d.onload=function(){c(d.clientWidth,d.clientHeight)},d.onerror=function(){c()};var e=d.style;e.visibility=&quot;hidden&quot;,e.position=&quot;fixed&quot;,e.bottom=e.left=0,e.width=e.height=&quot;auto&quot;,document.body.appendChild(d),d.src=a}function c(a,b,c){function d(a,c){return c=c||[],tinymce.each(a,function(a){var e={text:a.text||a.title};a.menu?e.menu=d(a.menu):(e.value=a.value,b(e)),c.push(e)}),c}return d(a,c||[])}function d(b){return function(){var c=a.settings.image_list;&quot;string&quot;==typeof c?tinymce.util.XHR.send({url:c,success:function(a){b(tinymce.util.JSON.parse(a))}}):&quot;function&quot;==typeof c?c(b):b(c)}}function e(d){function e(){var a,b,c,d;a=j.find(&quot;#width&quot;)[0],b=j.find(&quot;#height&quot;)[0],a&amp;&amp;b&amp;&amp;(c=a.value(),d=b.value(),j.find(&quot;#constrain&quot;)[0].checked()&amp;&amp;k&amp;&amp;l&amp;&amp;c&amp;&amp;d&amp;&amp;(k!=c?(d=Math.round(c/k*d),b.value(d)):(c=Math.round(d/l*c),a.value(c))),k=c,l=d)}function f(){function b(b){function c(){b.onload=b.onerror=null,a.selection&amp;&amp;(a.selection.select(b),a.nodeChanged())}b.onload=function(){o.width||o.height||!r||p.setAttribs(b,{width:b.clientWidth,height:b.clientHeight}),c()},b.onerror=c}i(),e(),o=tinymce.extend(o,j.toJSON()),o.alt||(o.alt=&quot;&quot;),&quot;&quot;===o.width&amp;&amp;(o.width=null),&quot;&quot;===o.height&amp;&amp;(o.height=null),o.style||(o.style=null),o={src:o.src,alt:o.alt,width:o.width,height:o.height,style:o.style,&quot;class&quot;:o[&quot;class&quot;]},a.undoManager.transact(function(){return o.src?(q?p.setAttribs(q,o):(o.id=&quot;__mcenew&quot;,a.focus(),a.selection.setContent(p.createHTML(&quot;img&quot;,o)),q=p.get(&quot;__mcenew&quot;),p.setAttrib(q,&quot;id&quot;,null)),void b(q)):void(q&amp;&amp;(p.remove(q),a.focus(),a.nodeChanged()))})}function g(a){return a&amp;&amp;(a=a.replace(/px$/,&quot;&quot;)),a}function h(c){var d=c.meta||{};if(m&amp;&amp;m.value(a.convertURL(this.value(),&quot;src&quot;)),tinymce.each(d,function(a,b){j.find(&quot;#&quot;+b).value(a)}),!d.width&amp;&amp;!d.height){var e=this.value(),f=new RegExp(&quot;^(?:[a-z]+:)?//&quot;,&quot;i&quot;),g=a.settings.document_base_url;g&amp;&amp;!f.test(e)&amp;&amp;e.substring(0,g.length)!==g&amp;&amp;this.value(g+e),b(this.value(),function(a){a.width&amp;&amp;a.height&amp;&amp;r&amp;&amp;(k=a.width,l=a.height,j.find(&quot;#width&quot;).value(k),j.find(&quot;#height&quot;).value(l))})}}function i(){function b(a){return a.length&gt;0&amp;&amp;/^[0-9]+$/.test(a)&amp;&amp;(a+=&quot;px&quot;),a}if(a.settings.image_advtab){var c=j.toJSON(),d=p.parseStyle(c.style);delete d.margin,d[&quot;margin-top&quot;]=d[&quot;margin-bottom&quot;]=b(c.vspace),d[&quot;margin-left&quot;]=d[&quot;margin-right&quot;]=b(c.hspace),d[&quot;border-width&quot;]=b(c.border),j.find(&quot;#style&quot;).value(p.serializeStyle(p.parseStyle(p.serializeStyle(d))))}}var j,k,l,m,n,o={},p=a.dom,q=a.selection.getNode(),r=a.settings.image_dimensions!==!1;k=p.getAttrib(q,&quot;width&quot;),l=p.getAttrib(q,&quot;height&quot;),&quot;IMG&quot;!=q.nodeName||q.getAttribute(&quot;data-mce-object&quot;)||q.getAttribute(&quot;data-mce-placeholder&quot;)?q=null:o={src:p.getAttrib(q,&quot;src&quot;),alt:p.getAttrib(q,&quot;alt&quot;),&quot;class&quot;:p.getAttrib(q,&quot;class&quot;),width:k,height:l},d&amp;&amp;(m={type:&quot;listbox&quot;,label:&quot;Image list&quot;,values:c(d,function(b){b.value=a.convertURL(b.value||b.url,&quot;src&quot;)},[{text:&quot;None&quot;,value:&quot;&quot;}]),value:o.src&amp;&amp;a.convertURL(o.src,&quot;src&quot;),onselect:function(a){var b=j.find(&quot;#alt&quot;);(!b.value()||a.lastControl&amp;&amp;b.value()==a.lastControl.text())&amp;&amp;b.value(a.control.text()),j.find(&quot;#src&quot;).value(a.control.value()).fire(&quot;change&quot;)},onPostRender:function(){m=this}}),a.settings.image_class_list&amp;&amp;(n={name:&quot;class&quot;,type:&quot;listbox&quot;,label:&quot;Class&quot;,values:c(a.settings.image_class_list,function(b){b.value&amp;&amp;(b.textStyle=function(){return a.formatter.getCssText({inline:&quot;img&quot;,classes:[b.value]})})})});var s=[{name:&quot;src&quot;,type:&quot;filepicker&quot;,filetype:&quot;image&quot;,label:&quot;Source&quot;,autofocus:!0,onchange:h},m];a.settings.image_description!==!1&amp;&amp;s.push({name:&quot;alt&quot;,type:&quot;textbox&quot;,label:&quot;Image description&quot;}),r&amp;&amp;s.push({type:&quot;container&quot;,label:&quot;Dimensions&quot;,layout:&quot;flex&quot;,direction:&quot;row&quot;,align:&quot;center&quot;,spacing:5,items:[{name:&quot;width&quot;,type:&quot;textbox&quot;,maxLength:5,size:3,onchange:e,ariaLabel:&quot;Width&quot;},{type:&quot;label&quot;,text:&quot;x&quot;},{name:&quot;height&quot;,type:&quot;textbox&quot;,maxLength:5,size:3,onchange:e,ariaLabel:&quot;Height&quot;},{name:&quot;constrain&quot;,type:&quot;checkbox&quot;,checked:!0,text:&quot;Constrain proportions&quot;}]}),s.push(n),a.settings.image_advtab?(q&amp;&amp;(o.hspace=g(q.style.marginLeft||q.style.marginRight),o.vspace=g(q.style.marginTop||q.style.marginBottom),o.border=g(q.style.borderWidth),o.style=a.dom.serializeStyle(a.dom.parseStyle(a.dom.getAttrib(q,&quot;style&quot;)))),j=a.windowManager.open({title:&quot;Insert/edit image&quot;,data:o,bodyType:&quot;tabpanel&quot;,body:[{title:&quot;General&quot;,type:&quot;form&quot;,items:s},{title:&quot;Advanced&quot;,type:&quot;form&quot;,pack:&quot;start&quot;,items:[{label:&quot;Style&quot;,name:&quot;style&quot;,type:&quot;textbox&quot;},{type:&quot;form&quot;,layout:&quot;grid&quot;,packV:&quot;start&quot;,columns:2,padding:0,alignH:[&quot;left&quot;,&quot;right&quot;],defaults:{type:&quot;textbox&quot;,maxWidth:50,onchange:i},items:[{label:&quot;Vertical space&quot;,name:&quot;vspace&quot;},{label:&quot;Horizontal space&quot;,name:&quot;hspace&quot;},{label:&quot;Border&quot;,name:&quot;border&quot;}]}]}],onSubmit:f})):j=a.windowManager.open({title:&quot;Insert/edit image&quot;,data:o,body:s,onSubmit:f})}a.addButton(&quot;image&quot;,{icon:&quot;image&quot;,tooltip:&quot;Insert/edit image&quot;,onclick:d(e),stateSelector:&quot;img:not([data-mce-object],[data-mce-placeholder])&quot;}),a.addMenuItem(&quot;image&quot;,{icon:&quot;image&quot;,text:&quot;Insert image&quot;,onclick:d(e),context:&quot;insert&quot;,prependToContext:!0}),a.addCommand(&quot;mceImage&quot;,d(e))});</pre>
</body>
</html>
