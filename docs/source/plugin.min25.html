<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">tinymce.PluginManager.add(&quot;media&quot;,function(a,b){function c(a){return-1!=a.indexOf(&quot;.mp3&quot;)?&quot;audio/mpeg&quot;:-1!=a.indexOf(&quot;.wav&quot;)?&quot;audio/wav&quot;:-1!=a.indexOf(&quot;.mp4&quot;)?&quot;video/mp4&quot;:-1!=a.indexOf(&quot;.webm&quot;)?&quot;video/webm&quot;:-1!=a.indexOf(&quot;.ogg&quot;)?&quot;video/ogg&quot;:-1!=a.indexOf(&quot;.swf&quot;)?&quot;application/x-shockwave-flash&quot;:&quot;&quot;}function d(b){var c=a.settings.media_scripts;if(c)for(var d=0;d&lt;c.length;d++)if(-1!==b.indexOf(c[d].filter))return c[d]}function e(){function b(a){var b,c,f,g;b=d.find(&quot;#width&quot;)[0],c=d.find(&quot;#height&quot;)[0],f=b.value(),g=c.value(),d.find(&quot;#constrain&quot;)[0].checked()&amp;&amp;e&amp;&amp;j&amp;&amp;f&amp;&amp;g&amp;&amp;(a.control==b?(g=Math.round(f/e*g),c.value(g)):(f=Math.round(g/j*f),b.value(f))),e=f,j=g}function c(){k=h(this.value()),this.parent().parent().fromJSON(k)}var d,e,j,k,l=[{name:&quot;source1&quot;,type:&quot;filepicker&quot;,filetype:&quot;media&quot;,size:40,autofocus:!0,label:&quot;Source&quot;,onchange:function(a){tinymce.each(a.meta,function(a,b){d.find(&quot;#&quot;+b).value(a)})}}];a.settings.media_alt_source!==!1&amp;&amp;l.push({name:&quot;source2&quot;,type:&quot;filepicker&quot;,filetype:&quot;media&quot;,size:40,label:&quot;Alternative source&quot;}),a.settings.media_poster!==!1&amp;&amp;l.push({name:&quot;poster&quot;,type:&quot;filepicker&quot;,filetype:&quot;image&quot;,size:40,label:&quot;Poster&quot;}),a.settings.media_dimensions!==!1&amp;&amp;l.push({type:&quot;container&quot;,label:&quot;Dimensions&quot;,layout:&quot;flex&quot;,align:&quot;center&quot;,spacing:5,items:[{name:&quot;width&quot;,type:&quot;textbox&quot;,maxLength:3,size:3,onchange:b},{type:&quot;label&quot;,text:&quot;x&quot;},{name:&quot;height&quot;,type:&quot;textbox&quot;,maxLength:3,size:3,onchange:b},{name:&quot;constrain&quot;,type:&quot;checkbox&quot;,checked:!0,text:&quot;Constrain proportions&quot;}]}),k=i(a.selection.getNode()),e=k.width,j=k.height;var n={id:&quot;mcemediasource&quot;,type:&quot;textbox&quot;,flex:1,name:&quot;embed&quot;,value:f(),multiline:!0,label:&quot;Source&quot;};n[m]=c,d=a.windowManager.open({title:&quot;Insert/edit video&quot;,data:k,bodyType:&quot;tabpanel&quot;,body:[{title:&quot;General&quot;,type:&quot;form&quot;,onShowTab:function(){k=h(this.next().find(&quot;#embed&quot;).value()),this.fromJSON(k)},items:l},{title:&quot;Embed&quot;,type:&quot;panel&quot;,layout:&quot;flex&quot;,direction:&quot;column&quot;,align:&quot;stretch&quot;,padding:10,spacing:10,onShowTab:function(){this.find(&quot;#embed&quot;).value(g(this.parent().toJSON()))},items:[{type:&quot;label&quot;,text:&quot;Paste your embed code below:&quot;,forId:&quot;mcemediasource&quot;},n]}],onSubmit:function(){var b,c,d,e;for(b=a.dom.select(&quot;img[data-mce-object]&quot;),a.insertContent(g(this.toJSON())),c=a.dom.select(&quot;img[data-mce-object]&quot;),d=0;d&lt;b.length;d++)for(e=c.length-1;e&gt;=0;e--)b[d]==c[e]&amp;&amp;c.splice(e,1);a.selection.select(c[0]),a.nodeChanged()}})}function f(){var b=a.selection.getNode();return b.getAttribute(&quot;data-mce-object&quot;)?a.selection.getContent():void 0}function g(e){var f=&quot;&quot;;if(!e.source1&amp;&amp;(tinymce.extend(e,h(e.embed)),!e.source1))return&quot;&quot;;if(e.source2||(e.source2=&quot;&quot;),e.poster||(e.poster=&quot;&quot;),e.source1=a.convertURL(e.source1,&quot;source&quot;),e.source2=a.convertURL(e.source2,&quot;source&quot;),e.source1mime=c(e.source1),e.source2mime=c(e.source2),e.poster=a.convertURL(e.poster,&quot;poster&quot;),e.flashPlayerUrl=a.convertURL(b+&quot;/moxieplayer.swf&quot;,&quot;movie&quot;),tinymce.each(l,function(a){var b,c,d;if(b=a.regex.exec(e.source1)){for(d=a.url,c=0;b[c];c++)d=d.replace(&quot;$&quot;+c,function(){return b[c]});e.source1=d,e.type=a.type,e.width=e.width||a.w,e.height=e.height||a.h}}),e.embed)f=k(e.embed,e,!0);else{var g=d(e.source1);g&amp;&amp;(e.type=&quot;script&quot;,e.width=g.width,e.height=g.height),e.width=e.width||300,e.height=e.height||150,tinymce.each(e,function(b,c){e[c]=a.dom.encode(b)}),&quot;iframe&quot;==e.type?f+=&#39;&lt;iframe src=&quot;&#39;+e.source1+&#39;&quot; width=&quot;&#39;+e.width+&#39;&quot; height=&quot;&#39;+e.height+&#39;&quot;&gt;&lt;/iframe&gt;&#39;:&quot;application/x-shockwave-flash&quot;==e.source1mime?(f+=&#39;&lt;object data=&quot;&#39;+e.source1+&#39;&quot; width=&quot;&#39;+e.width+&#39;&quot; height=&quot;&#39;+e.height+&#39;&quot; type=&quot;application/x-shockwave-flash&quot;&gt;&#39;,e.poster&amp;&amp;(f+=&#39;&lt;img src=&quot;&#39;+e.poster+&#39;&quot; width=&quot;&#39;+e.width+&#39;&quot; height=&quot;&#39;+e.height+&#39;&quot; /&gt;&#39;),f+=&quot;&lt;/object&gt;&quot;):-1!=e.source1mime.indexOf(&quot;audio&quot;)?a.settings.audio_template_callback?f=a.settings.audio_template_callback(e):f+=&#39;&lt;audio controls=&quot;controls&quot; src=&quot;&#39;+e.source1+&#39;&quot;&gt;&#39;+(e.source2?&#39;\n&lt;source src=&quot;&#39;+e.source2+&#39;&quot;&#39;+(e.source2mime?&#39; type=&quot;&#39;+e.source2mime+&#39;&quot;&#39;:&quot;&quot;)+&quot; /&gt;\n&quot;:&quot;&quot;)+&quot;&lt;/audio&gt;&quot;:&quot;script&quot;==e.type?f+=&#39;&lt;script src=&quot;&#39;+e.source1+&#39;&quot;&gt;&lt;/script&gt;&#39;:f=a.settings.video_template_callback?a.settings.video_template_callback(e):&#39;&lt;video width=&quot;&#39;+e.width+&#39;&quot; height=&quot;&#39;+e.height+&#39;&quot;&#39;+(e.poster?&#39; poster=&quot;&#39;+e.poster+&#39;&quot;&#39;:&quot;&quot;)+&#39; controls=&quot;controls&quot;&gt;\n&lt;source src=&quot;&#39;+e.source1+&#39;&quot;&#39;+(e.source1mime?&#39; type=&quot;&#39;+e.source1mime+&#39;&quot;&#39;:&quot;&quot;)+&quot; /&gt;\n&quot;+(e.source2?&#39;&lt;source src=&quot;&#39;+e.source2+&#39;&quot;&#39;+(e.source2mime?&#39; type=&quot;&#39;+e.source2mime+&#39;&quot;&#39;:&quot;&quot;)+&quot; /&gt;\n&quot;:&quot;&quot;)+&quot;&lt;/video&gt;&quot;}return f}function h(a){var b={};return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!0,special:&quot;script,noscript&quot;,start:function(a,c){if(b.source1||&quot;param&quot;!=a||(b.source1=c.map.movie),(&quot;iframe&quot;==a||&quot;object&quot;==a||&quot;embed&quot;==a||&quot;video&quot;==a||&quot;audio&quot;==a)&amp;&amp;(b.type||(b.type=a),b=tinymce.extend(c.map,b)),&quot;script&quot;==a){var e=d(c.map.src);if(!e)return;b={type:&quot;script&quot;,source1:c.map.src,width:e.width,height:e.height}}&quot;source&quot;==a&amp;&amp;(b.source1?b.source2||(b.source2=c.map.src):b.source1=c.map.src),&quot;img&quot;!=a||b.poster||(b.poster=c.map.src)}}).parse(a),b.source1=b.source1||b.src||b.data,b.source2=b.source2||&quot;&quot;,b.poster=b.poster||&quot;&quot;,b}function i(b){return b.getAttribute(&quot;data-mce-object&quot;)?h(a.serializer.serialize(b,{selection:!0})):{}}function j(b){if(a.settings.media_filter_html===!1)return b;var c=new tinymce.html.Writer;return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!1,special:&quot;script,noscript&quot;,comment:function(a){c.comment(a)},cdata:function(a){c.cdata(a)},text:function(a,b){c.text(a,b)},start:function(a,b,d){if(&quot;script&quot;!=a&amp;&amp;&quot;noscript&quot;!=a){for(var e=0;e&lt;b.length;e++)if(0===b[e].name.indexOf(&quot;on&quot;))return;c.start(a,b,d)}},end:function(a){&quot;script&quot;!=a&amp;&amp;&quot;noscript&quot;!=a&amp;&amp;c.end(a)}},new tinymce.html.Schema({})).parse(b),c.getContent()}function k(a,b,c){function d(a,b){var c,d,e,f;for(c in b)if(e=&quot;&quot;+b[c],a.map[c])for(d=a.length;d--;)f=a[d],f.name==c&amp;&amp;(e?(a.map[c]=e,f.value=e):(delete a.map[c],a.splice(d,1)));else e&amp;&amp;(a.push({name:c,value:e}),a.map[c]=e)}var e,f=new tinymce.html.Writer,g=0;return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!0,special:&quot;script,noscript&quot;,comment:function(a){f.comment(a)},cdata:function(a){f.cdata(a)},text:function(a,b){f.text(a,b)},start:function(a,h,i){switch(a){case&quot;video&quot;:case&quot;object&quot;:case&quot;embed&quot;:case&quot;img&quot;:case&quot;iframe&quot;:d(h,{width:b.width,height:b.height})}if(c)switch(a){case&quot;video&quot;:d(h,{poster:b.poster,src:&quot;&quot;}),b.source2&amp;&amp;d(h,{src:&quot;&quot;});break;case&quot;iframe&quot;:d(h,{src:b.source1});break;case&quot;source&quot;:if(g++,2&gt;=g&amp;&amp;(d(h,{src:b[&quot;source&quot;+g],type:b[&quot;source&quot;+g+&quot;mime&quot;]}),!b[&quot;source&quot;+g]))return;break;case&quot;img&quot;:if(!b.poster)return;e=!0}f.start(a,h,i)},end:function(a){if(&quot;video&quot;==a&amp;&amp;c)for(var h=1;2&gt;=h;h++)if(b[&quot;source&quot;+h]){var i=[];i.map={},h&gt;g&amp;&amp;(d(i,{src:b[&quot;source&quot;+h],type:b[&quot;source&quot;+h+&quot;mime&quot;]}),f.start(&quot;source&quot;,i,!0))}if(b.poster&amp;&amp;&quot;object&quot;==a&amp;&amp;c&amp;&amp;!e){var j=[];j.map={},d(j,{src:b.poster,width:b.width,height:b.height}),f.start(&quot;img&quot;,j,!0)}f.end(a)}},new tinymce.html.Schema({})).parse(a),f.getContent()}var l=[{regex:/youtu\.be\/([\w\-.]+)/,type:&quot;iframe&quot;,w:425,h:350,url:&quot;//www.youtube.com/embed/$1&quot;},{regex:/youtube\.com(.+)v=([^&amp;]+)/,type:&quot;iframe&quot;,w:425,h:350,url:&quot;//www.youtube.com/embed/$2&quot;},{regex:/vimeo\.com\/([0-9]+)/,type:&quot;iframe&quot;,w:425,h:350,url:&quot;//player.vimeo.com/video/$1?title=0&amp;byline=0&amp;portrait=0&amp;color=8dc7dc&quot;},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:&quot;iframe&quot;,w:425,h:350,url:&quot;//player.vimeo.com/video/$2?title=0&amp;amp;byline=0&quot;},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:&quot;iframe&quot;,w:425,h:350,url:&#39;//maps.google.com/maps/ms?msid=$2&amp;output=embed&quot;&#39;}],m=tinymce.Env.ie&amp;&amp;tinymce.Env.ie&lt;=8?&quot;onChange&quot;:&quot;onInput&quot;;a.on(&quot;ResolveName&quot;,function(a){var b;1==a.target.nodeType&amp;&amp;(b=a.target.getAttribute(&quot;data-mce-object&quot;))&amp;&amp;(a.name=b)}),a.on(&quot;preInit&quot;,function(){var b=a.schema.getSpecialElements();tinymce.each(&quot;video audio iframe object&quot;.split(&quot; &quot;),function(a){b[a]=new RegExp(&quot;&lt;/&quot;+a+&quot;[^&gt;]*&gt;&quot;,&quot;gi&quot;)});var c=a.schema.getBoolAttrs();tinymce.each(&quot;webkitallowfullscreen mozallowfullscreen allowfullscreen&quot;.split(&quot; &quot;),function(a){c[a]={}}),a.parser.addNodeFilter(&quot;iframe,video,audio,object,embed,script&quot;,function(b,c){for(var e,f,g,h,i,j,k,l,m=b.length;m--;)if(f=b[m],f.parent&amp;&amp;(&quot;script&quot;!=f.name||(l=d(f.attr(&quot;src&quot;))))){for(g=new tinymce.html.Node(&quot;img&quot;,1),g.shortEnded=!0,l&amp;&amp;(l.width&amp;&amp;f.attr(&quot;width&quot;,l.width.toString()),l.height&amp;&amp;f.attr(&quot;height&quot;,l.height.toString())),j=f.attributes,e=j.length;e--;)h=j[e].name,i=j[e].value,&quot;width&quot;!==h&amp;&amp;&quot;height&quot;!==h&amp;&amp;&quot;style&quot;!==h&amp;&amp;((&quot;data&quot;==h||&quot;src&quot;==h)&amp;&amp;(i=a.convertURL(i,h)),g.attr(&quot;data-mce-p-&quot;+h,i));k=f.firstChild&amp;&amp;f.firstChild.value,k&amp;&amp;(g.attr(&quot;data-mce-html&quot;,escape(k)),g.firstChild=null),g.attr({width:f.attr(&quot;width&quot;)||&quot;300&quot;,height:f.attr(&quot;height&quot;)||(&quot;audio&quot;==c?&quot;30&quot;:&quot;150&quot;),style:f.attr(&quot;style&quot;),src:tinymce.Env.transparentSrc,&quot;data-mce-object&quot;:c,&quot;class&quot;:&quot;mce-object mce-object-&quot;+c}),f.replace(g)}}),a.serializer.addAttributeFilter(&quot;data-mce-object&quot;,function(a,b){for(var c,d,e,f,g,h,i,k=a.length;k--;)if(c=a[k],c.parent){for(i=c.attr(b),d=new tinymce.html.Node(i,1),&quot;audio&quot;!=i&amp;&amp;&quot;script&quot;!=i&amp;&amp;d.attr({width:c.attr(&quot;width&quot;),height:c.attr(&quot;height&quot;)}),d.attr({style:c.attr(&quot;style&quot;)}),f=c.attributes,e=f.length;e--;){var l=f[e].name;0===l.indexOf(&quot;data-mce-p-&quot;)&amp;&amp;d.attr(l.substr(11),f[e].value)}&quot;script&quot;==i&amp;&amp;d.attr(&quot;type&quot;,&quot;text/javascript&quot;),g=c.attr(&quot;data-mce-html&quot;),g&amp;&amp;(h=new tinymce.html.Node(&quot;#text&quot;,3),h.raw=!0,h.value=j(unescape(g)),d.append(h)),c.replace(d)}})}),a.on(&quot;ObjectSelected&quot;,function(a){var b=a.target.getAttribute(&quot;data-mce-object&quot;);(&quot;audio&quot;==b||&quot;script&quot;==b)&amp;&amp;a.preventDefault()}),a.on(&quot;objectResized&quot;,function(a){var b,c=a.target;c.getAttribute(&quot;data-mce-object&quot;)&amp;&amp;(b=c.getAttribute(&quot;data-mce-html&quot;),b&amp;&amp;(b=unescape(b),c.setAttribute(&quot;data-mce-html&quot;,escape(k(b,{width:a.width,height:a.height})))))}),a.addButton(&quot;media&quot;,{tooltip:&quot;Insert/edit video&quot;,onclick:e,stateSelector:[&quot;img[data-mce-object=video]&quot;,&quot;img[data-mce-object=iframe]&quot;]}),a.addMenuItem(&quot;media&quot;,{icon:&quot;media&quot;,text:&quot;Insert video&quot;,onclick:e,context:&quot;insert&quot;,prependToContext:!0})});</pre>
</body>
</html>
