<%= javascript_tag do %>
    function selectAll(e){$('ul.widgets input[type="checkbox"]').prop('checked',$('#select_all_widgets').prop('checked'));}
<% end %>
<%= form_for(@author_site_storage) do |f| -%>

    <%= render_notification(@author_site_storage) -%>
    <%= render_text_field(f, :key, !@author_site_storage.key.nil?) -%>
    <%= render_text_area(f, :content) -%>
    <%= render_collection(f, 'Type', {
                                   id: :site_type_id,
                                   collection: @author_site_types,
                                   index: :id,
                                   value: :name
                           }) -%>

    <%= render_activated_version(f) -%>

    <div class="field">
      <label>
        <%= check_box_tag 'select_all_widgets', 'select_all_widgets', false, {onchange: 'selectAll()'} %>
        <%= label_tag 'select_all_widgets', 'Select widgets' %>
        <%= hidden_field_tag 'author_site_storage[author_site_storage_widget_ids][]', nil %>
        <ul class="categories">
          <% Author::WidgetCategory.order(:name_value).each do |category| %>
              <li>
                <%= label_tag dom_id(category), category.name_value %>
                <ul class="widgets">
                  <% category.author_widgets.order(:name).each do |widget| %>
                      <li>
                        <%= check_box_tag 'author_site_storage[author_site_storage_widget_ids][]',
                                          widget.id,
                                          @author_site_storage.author_site_storage_widget_ids.include?(widget.id),
                                          id: dom_id(widget) %>
                        <%= label_tag dom_id(widget), widget.name, {title: "#{widget.name}\n#{widget.description}"} %>
                      </li>
                  <% end %>
                </ul>
              </li>
          <% end %>
        </ul>
    </div>

    <%= render_submit(f) -%>

<% end -%>
