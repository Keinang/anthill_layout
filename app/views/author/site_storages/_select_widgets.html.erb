<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">
            <label class="pull-left" onclick="selectAll(this)" for="select_all_widgets">(Un)Select All widgets</label>
            <span class="badge"><%= @author_site_storage.author_widgets.size %></span>
        </h3>
    </div>
    <div class="panel-body">
        <div class="row">
            <%= hidden_field_tag('author_site_storage[author_site_storage_widget_ids][]', nil) %>
            <% render_loop(@widget_categories, 'category_widgets') %>
        </div>
    </div>
</div>
<%= javascript_tag "function selectAll(e){var $c=$(e).attr('for')===\"select_all_widgets\"?\"ul.widgets\":$(e).next(),$w=$('input[type=\"checkbox\"]',$c);$w.prop('checked',!$w.prop('checked'));updateCounter();}function updateCounter(){var $l=$('label[for=\"select_all_widgets\"]');$l.text($l.text().replace(/\\d+/,$('input[type=\"checkbox\"]:checked').length));}".html_safe %>